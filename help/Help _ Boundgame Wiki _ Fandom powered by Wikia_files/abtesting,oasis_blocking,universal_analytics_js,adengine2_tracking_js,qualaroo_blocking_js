(function(window){var AbTest,Wikia=window.Wikia=(window.Wikia||{}),config=Wikia.AbTestConfig||{},logCache={},beacon=window.beacon_id||getCookie('wikia_beacon_id'),serverTimeString=window.varnishTime,serverDate=serverTimeString?new Date(serverTimeString):new Date(),serverTime=serverDate.getTime()/1000;var log=(function(console){return(console&&console.log)?function(methodName,message){if(!message){message=methodName;methodName=undefined;}
if(!logCache[message]){logCache[message]=true;console.log('Wikia.AbTest'+(methodName?'.'+methodName+'()':'')+':',message);}}:function(){};})(window.console);AbTest=function(expName){this.expName=expName;};AbTest.uuid=(function(uuid){var ret=uuid&&uuid!='ThisIsFake'?uuid:null;if(!ret){log('init','UUID is not available, A/B testing will be disabled');}
return ret;})(beacon);AbTest.isExperimentActive=function(expName){return expName in AbTest.experiments;};AbTest.getGroup=function(expName){var exp=getExperiment(expName,'getGroup'),group=exp&&exp.group;return group&&group.name;};AbTest.inGroup=function(expName,groupName){return AbTest.getGroup(expName)===groupName;};AbTest.isValidGroup=function(expName,groupName){var exp=getExperiment(expName,'isValidGroup'),current=exp&&exp.current;return!!(current&&current.groups[groupName]);};AbTest.getGASlot=function(expName){var exp=getExperiment(expName,'getGASlot'),current=exp&&exp.current,gaSlot=current&&current.gaSlot;return parseInt(gaSlot,10)||undefined;};AbTest.getExperiments=function(includeAll){var expName,exp,group,el,list=[];if(!AbTest.uuid){list.nouuid=true;}
for(expName in AbTest.experiments){exp=AbTest.experiments[expName];group=exp.group;if(!group&&!includeAll){continue;}
el={id:exp.id,name:exp.name,flags:exp.flags};if(group){el.group={id:group.id,name:group.name}}
list.push(el);}
return list;};AbTest.loadExternalData=function(data){var index,groupData,html='';log('init','Received external configuration');for(index in data){groupData=data[index];if(groupData.styles){html+='<style>'+groupData.styles+'</style>';}
if(groupData.scripts){html+='<script>'+groupData.scripts+'</script>';}}
if(html!=''){document.write(html);}};(function(prototype){var i,length,methodNames=['inGroup','getGroup','getGASlot','getUserSlot'];for(i=0,length=methodNames.length;i<length;i++){(function(methodName){prototype[methodName]=function(){return AbTest[methodName].apply(AbTest,[this.expName].concat(arguments));};})(methodNames[i]);}})(AbTest.prototype);function getExperiment(expName,methodName){if(!expName){log(methodName,'Missing required argument "expName".');}
var exp=AbTest.experiments[expName];if(!exp){log(methodName,'Experiment configuration not found for "'+expName+'."');}
return exp;}
function hash(s){var slot=0,i;for(i=0;i<s.length;i++){slot+=s.charCodeAt(i)*(i+1);}
return Math.abs(slot)%100;}
function getSlot(expName){return AbTest.uuid?hash(AbTest.uuid+expName):-1;}
function setActiveGroup(expName,groupName,force){var exp=getExperiment(expName,'setActiveGroup'),current=exp&&exp.current,group=current&&current.groups[groupName];if(group&&(!exp.group||force)){exp.group=group;return true;}
return false;}
function isInRanges(value,ranges){var i,range;if(!ranges||!ranges.length){return false;}
for(i=0;i<ranges.length;i++){range=ranges[i];if(value>=range.min&&value<=range.max){return true;}}
return false;}
function getCookie(name){if(!name){return null;}
return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(name).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null;}
AbTest.experiments=(function(experiments){var expName,exp,versions,version,i,activeExperiments={},count=0;for(expName in experiments){if(experiments.hasOwnProperty(expName)){exp=experiments[expName];versions=exp.versions;for(i=0;i<versions.length;i++){version=versions[i];if(serverTime>=version.startTime&&serverTime<version.endTime){exp.current=version;exp.flags=version.flags;count++;break;}}
if(exp.current){activeExperiments[expName]=exp;}}}
AbTest.experimentCount=count;return activeExperiments;})(config.experiments||{});(function(experiments){var matches,rTreatmentGroups=/AbTest\.([^=]+)=([^?&]+)/gi,queryString=window.location.search,expName,groupName,exp,slot,externalIds=[];if(queryString){while((matches=rTreatmentGroups.exec(queryString))!=null){expName=matches[1];groupName=matches[2];if(!AbTest.isValidGroup(expName,groupName)){log('init','Invalid experiment/group specified in URL: '+expName+'/'+groupName);continue;}
setActiveGroup(expName,groupName);}}
for(expName in experiments){exp=experiments[expName];slot=getSlot(expName);if(exp.group||!exp.current||slot<0){continue;}
if(exp.flags&&exp.flags.limit_to_special_wikis&&!window.wgIsGASpecialWiki){log('init','Skipping experiment '+expName+' - not a special Wiki');continue;}
for(groupName in exp.current.groups){if(isInRanges(slot,exp.current.groups[groupName].ranges)){setActiveGroup(expName,groupName);}}}
for(expName in experiments){exp=experiments[expName];if(exp.current.external&&exp.group){externalIds.push(exp.name+'.'+exp.current.id+'.'+exp.group.id);}}
if(externalIds.length>0&&!window.Mercury){log('init','Loading external configuration');var url=window.wgCdnApiUrl+'/wikia.php?controller=AbTesting&method=externalData&callback=Wikia.AbTest.loadExternalData&ids=';url+=externalIds.join(',');document.write('<scr'+'ipt src="'+encodeURI(url)+'"></script>');}})(AbTest.experiments);(function(experiments){var expName,exp;for(expName in experiments){exp=experiments[expName];if(Wikia.Tracker&&exp.flags&&exp.flags.dw_tracking&&exp.group){Wikia.Tracker.track({eventName:'ab_treatment',experiment:exp.name,experimentId:exp.id,time:serverTimeString,trackingMethod:'internal',treatmentGroup:exp.group.name,treatmentGroupId:exp.group.id});}}})(AbTest.experiments);Wikia.AbTest=AbTest;})(window);;


(function(context){'use strict';function lazyQueue(){function makeQueue(queue,callback){if(typeof callback!=='function'){throw new Error('LazyQueue used with callback not being a function');}else if(queue instanceof Array){queue.start=function(){while(queue.length>0){callback(queue.shift());}
queue.push=function(item){callback(item);};};return queue;}else{throw new Error('LazyQueue requires an array as the first parameter');}}
return{makeQueue:makeQueue};}
if(!context.Wikia){context.Wikia={};}
context.Wikia.LazyQueue=lazyQueue();if(context.define&&context.define.amd){context.define('wikia.lazyqueue',lazyQueue);}}(this));;


(function(window,undefined){'use strict';if(!window.wgNoExternals){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments);},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m);})(window,document,'script','//www.google-analytics.com/analytics.js','ga');}else{window.ga=function(){};}
var cookieExists,isProductionEnv,blockingTracked={sourcePoint:false,pageFair:false},GASettings={sourcePoint:{trackName:'sourcePoint',name:'sourcepoint',dimension:6},pageFair:{trackName:'pageFair',dimension:7,name:'pagefair'}},listenerSettings=[{eventName:'sp.blocking',value:true,detectorSettings:GASettings.sourcePoint},{eventName:'sp.not_blocking',value:false,detectorSettings:GASettings.sourcePoint},{eventName:'pf.blocking',value:true,detectorSettings:GASettings.pageFair},{eventName:'pf.not_blocking',value:false,detectorSettings:GASettings.pageFair}];isProductionEnv=!window.wgGaStaging;cookieExists=function(cookieName){return document.cookie.indexOf(cookieName)>-1;};if(isProductionEnv){window.ga('create','UA-32129070-1','auto',{'sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});}else{window.ga('create','UA-32129070-2','auto',{'sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});}
if(window.wgIsGASpecialWiki){if(isProductionEnv){window.ga('create','UA-32132943-1','auto',{'name':'special','sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});}else{window.ga('create','UA-32132943-2','auto',{'name':'special','sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});}
window.ga('special.require','displayfeatures');}
if(window.wgGAUserIdHash){if(isProductionEnv){window.ga('create','UA-32132943-7','auto',{'name':'loggedin_users','sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});}else{window.ga('create','UA-32132943-8','auto',{'name':'loggedin_users','sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});window.ga('loggedin_users.require','displayfeatures');}}
if(isProductionEnv){window.ga('create','UA-32132943-4','auto',{'name':'ve','sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});window.ga('ve.require','displayfeatures');}
window.ga('require','displayfeatures');function _gaWikiaPush(commands){var i,spec,args=Array.prototype.slice.call(arguments);for(i=0;i<args.length;i++){if(typeof args[i]==='function'){window.ga(args[i]);continue;}else if(args[i][0]==='send'&&args[i].length===7){args[i][6]={'nonInteraction':args[i][6]};}
window.ga.apply(window,args[i]);if(args[i][0].indexOf('.')===-1){if(window.wgIsGASpecialWiki){spec=args[i].slice();spec[0]='special.'+spec[0];window.ga.apply(window,spec);}
if(window.wgGAUserIdHash){spec=args[i].slice();spec[0]='loggedin_users.'+spec[0];window.ga.apply(window,spec);}
if(args[i][1]&&args[i][1]==='editor-ve'){spec=args[i].slice();spec[0]='ve.'+spec[0];window.ga.apply(window,spec);}}}}
function getEsrbRating(){var rating='not set';if(window.ads&&window.ads.context.targeting.esrbRating){rating=window.ads.context.targeting.esrbRating;}
return rating;}
function hasPortableInfobox(){if(window.ads&&window.ads.context.targeting.hasPortableInfobox){return'Yes';}
return'No';}
function getKruxSegment(){var kruxSegment='not set',uniqueKruxSegments={ocry7a4xg:'Game Heroes 2014',ocr1te1tc:'Digital DNA 2014',ocr6m2jd6:'Inquisitive Minds 2014',ocr05ve5z:'Culture Caster 2014',ocr88oqh9:'Social Entertainers 2014'},uniqueKruxSegmentsKeys=Object.keys(uniqueKruxSegments),markedSegments=[],kruxSegments=[];if(window.localStorage){kruxSegments=(window.localStorage.kxsegs||'').split(',');}
if(kruxSegments.length){markedSegments=uniqueKruxSegmentsKeys.filter(function(n){return kruxSegments.indexOf(n)!==-1;});if(markedSegments.length){kruxSegment=uniqueKruxSegments[markedSegments[0]];}}
return kruxSegment;}
function trackBlocking(detectorSettings,isBlocked){var value=isBlocked?'Yes':'No';if(blockingTracked[detectorSettings.trackName]){return;}
blockingTracked[detectorSettings.trackName]=true;_gaWikiaPush(['set','dimension'+detectorSettings.dimension,value]);window.ga('ads.set','dimension'+detectorSettings.dimension,value);guaTrackAdEvent('ad/'+detectorSettings.name+'/detection',value,'',0,true);guaTrackEvent('ads-'+detectorSettings.name+'-detection','impression',value,0,true);}
_gaWikiaPush(['set','dimension1',window.wgDBname],['set','dimension2',window.wgContentLanguage],['set','dimension3',window.cscoreCat],['set','dimension4',window.skin],['set','dimension5',!!window.wgUserName?'user':'anon']);function getUnconfirmedEmailUserType(){if(!window.wgUserName){return'anon';}else{switch(window.wgNotConfirmedEmail){case'1':return'unconfirmed';case'2':return'confirmed';default:return'old user';}}}
_gaWikiaPush(['set','dimension8',window.wikiaPageType],['set','dimension9',window.wgCityId],['set','dimension13',getEsrbRating()],['set','dimension14',window.wgGaHasAds?'Yes':'No'],['set','dimension15',window.wikiaPageIsCorporate?'Yes':'No'],['set','dimension16',getKruxSegment()],['set','dimension17',window.wgWikiVertical],['set','dimension18',window.wgWikiCategories.join(',')],['set','dimension19',window.wgArticleType],['set','dimension20','not set'],['set','dimension21',String(window.wgArticleId)],['set','dimension23',window.wikiaIsPowerUserFrequent?'Yes':'No'],['set','dimension24',window.wikiaIsPowerUserLifetime?'Yes':'No'],['set','dimension25',String(window.wgNamespaceNumber)],['set','dimension26',String(window.wgSeoTestingBucket||0)],['set','dimension27',String(window.wgCanonicalSpecialPageName||'')],['set','dimension28',hasPortableInfobox()]);_gaWikiaPush(['set','dimension39',getUnconfirmedEmailUserType()]);function isOptimizelyLoadedAndActive(){var optimizely=window.optimizely;return optimizely&&optimizely.activeExperiments&&Array.isArray(optimizely.activeExperiments)&&optimizely.activeExperiments.length>0&&typeof optimizely.allExperiments==='object'&&Object.keys(optimizely.allExperiments).length>0&&typeof optimizely.variationNamesMap==='object'&&Object.keys(optimizely.variationNamesMap).length>0;}
if(isOptimizelyLoadedAndActive()){var optimizely=window.optimizely;optimizely.activeExperiments.forEach(function(experimentId){if(optimizely.allExperiments.hasOwnProperty(experimentId)&&typeof optimizely.allExperiments[experimentId].universal_analytics==='object'){var dimension=optimizely.allExperiments[experimentId].universal_analytics.slot,experimentName=optimizely.allExperiments[experimentId].name,variationName=optimizely.variationNamesMap[experimentId];_gaWikiaPush(['set','dimension'+dimension,'Optimizely '+experimentName+' ('+experimentId+'): '+variationName]);}});}
if(window.Wikia&&window.Wikia.AbTest){var abList=window.Wikia.AbTest.getExperiments(true),abExp,abGroupName,abSlot,abIndex,abForceTrackOnLoad=false,abCustomVarsForAds=[];for(abIndex=0;abIndex<abList.length;abIndex++){abExp=abList[abIndex];if(!abExp||!abExp.flags){continue;}
if(!abExp.flags.ga_tracking){continue;}
if(abExp.flags.forced_ga_tracking_on_load&&abExp.group){abForceTrackOnLoad=true;}
abSlot=window.Wikia.AbTest.getGASlot(abExp.name);if(abSlot>=40&&abSlot<=49){abGroupName=abExp.group?abExp.group.name:(abList.nouuid?'NOBEACON':'NOT_IN_ANY_GROUP');_gaWikiaPush(['set','dimension'+abSlot,abGroupName]);abCustomVarsForAds.push(['ads.set','dimension'+abSlot,abGroupName]);}}
if(abForceTrackOnLoad){var abRenderStart=window.wgNow||(new Date()),abOnLoadHandler;abOnLoadHandler=function(){var renderTime=(new Date()).getTime()-abRenderStart.getTime();setTimeout(function(){window.guaTrackEvent('ABtest','ONLOAD','TIME',renderTime);},10);};if(window.attachEvent){window.attachEvent('onload',abOnLoadHandler);}else if(window.addEventListener){window.addEventListener('load',abOnLoadHandler,false);}}}
_gaWikiaPush(['send','pageview']);if(window.ads&&window.ads.context.opts.showAds){listenerSettings.map(function(listenerSetting){document.addEventListener(listenerSetting.eventName,function(){trackBlocking(listenerSetting.detectorSettings,listenerSetting.value);});});}
if(isProductionEnv){window.ga('create','UA-32129071-1','auto',{'name':'ads','sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});}else{window.ga('create','UA-32129071-2','auto',{'name':'ads','sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});}
window.ga('ads.require','displayfeatures');window.ga('ads.set','dimension1',window.wgDBname);window.ga('ads.set','dimension2',window.wgContentLanguage);window.ga('ads.set','dimension3',window.cscoreCat);window.ga('ads.set','dimension4',window.skin);window.ga('ads.set','dimension5',!!window.wgUserName?'user':'anon');window.ga('ads.set','dimension8',window.wikiaPageType);window.ga('ads.set','dimension9',window.wgCityId);window.ga('ads.set','dimension13',getEsrbRating());window.ga('ads.set','dimension14',window.wgGaHasAds?'Yes':'No');window.ga('ads.set','dimension15',window.wikiaPageIsCorporate?'Yes':'No');window.ga('ads.set','dimension16',getKruxSegment());window.ga('ads.set','dimension17',window.wgWikiVertical);window.ga('ads.set','dimension18',window.wgWikiCategories.join(','));window.ga('ads.set','dimension19',window.wgArticleType);window.ga('ads.set','dimension20','not set');window.ga('ads.set','dimension21',String(window.wgArticleId));window.ga('ads.set','dimension23',window.wikiaIsPowerUserFrequent?'Yes':'No');window.ga('ads.set','dimension24',window.wikiaIsPowerUserLifetime?'Yes':'No');window.ga('ads.set','dimension25',String(window.wgNamespaceNumber));window.ga('ads.set','dimension26',String(window.wgSeoTestingBucket||0));window.ga('ads.set','dimension27',String(window.wgCanonicalSpecialPageName||''));window.ga('ads.set','dimension28',hasPortableInfobox());if(window.Wikia&&window.Wikia.AbTest){var i;for(i=0;i<abCustomVarsForAds.length;i++){window.ga.apply(window,abCustomVarsForAds[i]);}}
window.guaTrackAdEvent=function(category,action,opt_label,opt_value,opt_noninteractive){var args,adHitSample=1;if(Math.random()*100<=adHitSample){args=Array.prototype.slice.call(arguments);if(args.length===5){args[4]={'nonInteraction':args[4]};}
args.unshift('ads.send','event');try{window.ga.apply(window,args);}catch(e){}}};window.guaTrackEvent=function(category,action,opt_label,opt_value,opt_noninteractive){var args=Array.prototype.slice.call(arguments);args.unshift('send','event');try{_gaWikiaPush(args);}catch(e){}};window.guaTrackPageview=function(fakePage,opt_namespace){var nsPrefix=(opt_namespace)?opt_namespace+'.':'';_gaWikiaPush([nsPrefix+'send','pageview',fakePage]);};}(window));;


define('ext.wikia.adEngine.adLogicPageParams',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.adLogicPageViewCounter','ext.wikia.adEngine.utils.adLogicZoneParams','wikia.document','wikia.geo','wikia.location','wikia.log','wikia.window',require.optional('wikia.abTest'),require.optional('wikia.krux')],function(adContext,pvCounter,zoneParams,doc,geo,loc,log,win,abTest,krux){'use strict';var context={},logGroup='ext.wikia.adEngine.adLogicPageParams',runtimeParams={},skin=adContext.getContext().targeting.skin;function updateContext(){context=adContext.getContext();}
function getAb(){var experiments,experimentsNumber,i,ab=[];if(abTest){experiments=abTest.getExperiments();experimentsNumber=experiments.length;for(i=0;i<experimentsNumber;i+=1){ab.push(experiments[i].id+'_'+experiments[i].group.id);}}
return ab;}
function extend(target,obj){var key;for(key in obj){if(obj.hasOwnProperty(key)){target[key]=obj[key];}}
return target;}
function addParam(key,value){runtimeParams[key]=value;}
function decodeLegacyDartParams(dartString){var params={},kvs,kv,key,value,i,len;log(['decodeLegacyDartParams',dartString],9,logGroup);if(typeof dartString==='string'){kvs=dartString.split(';');for(i=0,len=kvs.length;i<len;i+=1){kv=kvs[i].split('=');key=kv[0];value=kv[1];if(key&&value&&key!=='esrb'){params[key]=params[key]||[];params[key].push(value);}}}
return params;}
function getRefParam(){var hostnameMatch,ref=doc.referrer,refHostname,searchDomains=/(google|search\.yahooo|bing|baidu|ask|yandex)/,wikiDomains=['wikia.com','ffxiclopedia.org','jedipedia.de','memory-alpha.org','uncyclopedia.org','websitewiki.de','wowwiki.com','yoyowiki.org'],wikiDomainsRegex=new RegExp('(^|\\.)('+wikiDomains.join('|').replace(/\./g,'\\.')+')$');if(!ref||typeof ref!=='string'){return'direct';}
refHostname=ref.match(/\/\/([^\/]+)\//);if(refHostname){refHostname=refHostname[1];}
hostnameMatch=refHostname===loc.hostname;if(hostnameMatch&&ref.indexOf('search=')>-1){return'wiki_search';}
if(hostnameMatch){return'wiki';}
hostnameMatch=wikiDomainsRegex.test(refHostname);if(hostnameMatch&&ref.indexOf('search=')>-1){return'wikia_search';}
if(hostnameMatch){return'wikia';}
if(searchDomains.test(refHostname)){return'external_search';}
return'external';}
function getAspectRatio(){return win.innerWidth>win.innerHeight?'4:3':'3:4';}
function getPageLevelParams(options){log('getPageLevelParams',9,logGroup);var params,targeting=context.targeting,pvs=pvCounter.get();options=options||{};params={s0:zoneParams.getSite(),s0v:zoneParams.getVertical(),s0c:zoneParams.getWikiCategories(),s1:zoneParams.getName(),s2:zoneParams.getPageType(),ab:getAb(),ar:getAspectRatio(),artid:targeting.pageArticleId&&targeting.pageArticleId.toString(),cat:zoneParams.getPageCategories(),dmn:zoneParams.getDomain(),hostpre:zoneParams.getHostnamePrefix(),skin:targeting.skin,lang:zoneParams.getLanguage(),wpage:targeting.pageName&&targeting.pageName.toLowerCase(),ref:getRefParam(),esrb:targeting.esrbRating,geo:geo.getCountryCode()||'none'};if(pvs){params.pv=pvs.toString();}
if(options.includeRawDbName){params.rawDbName=zoneParams.getRawDbName();}
if(krux&&targeting.enableKruxTargeting){params.u=krux.getUser();params.ksgmnt=krux.getSegments();}
if(targeting.wikiIsTop1000){params.top='1k';}
extend(params,decodeLegacyDartParams(targeting.wikiCustomKeyValues));extend(params,runtimeParams);log(params,9,logGroup);return params;}
if(skin&&skin!=='mercury'){pvCounter.increment();}
updateContext();adContext.addCallback(updateContext);return{add:addParam,getPageLevelParams:getPageLevelParams};});;define('ext.wikia.adEngine.adLogicPageViewCounter',['wikia.cache','wikia.window'],function(cache,window){'use strict';var cacheKey='adEngine_pageViewCounter',cacheTtl=24*3600*1000,now=window.wgNow||new Date(),initialValue={since:now.getTime(),pvs:0};function isValidValue(val){if(!val||isNaN(val.since)||isNaN(val.pvs)){return false;}
var pvs=val.pvs,age=now.getTime()-val.since;if(pvs<0||age<0||age>cacheTtl){return false;}
return true;}
function get(){var val=cache.get(cacheKey,now);if(!isValidValue(val)){val=initialValue;}
return val.pvs;}
function increment(){var val,age,ttlLeft;val=cache.get(cacheKey,now);if(!isValidValue(val)){val=initialValue;}
age=now.getTime()-val.since;ttlLeft=cacheTtl-age;val.pvs+=1;cache.set(cacheKey,val,ttlLeft,now);}
return{get:get,increment:increment};});;define('ext.wikia.adEngine.adTracker',['ext.wikia.adEngine.utils.timeBuckets','wikia.tracker','wikia.window','wikia.log'],function(timeBuckets,tracker,win,log){'use strict';var buckets=[0.0,0.5,1.0,1.5,2.0,2.5,3.5,5.0,8.0,20.0,60.0],logGroup='ext.wikia.adEngine.adTracker';function encodeAsQueryString(extraParams){var out=[],key,keys=[],i,len;if(win.ads&&win.ads.runtime.sp&&typeof win.ads.runtime.sp.blocking==='boolean'){extraParams.sp=win.ads.runtime.sp.blocking?'yes':'no';}
if(win.ads&&win.ads.runtime.pf&&typeof win.ads.runtime.pf.blocking==='boolean'){extraParams.pf=win.ads.runtime.pf.blocking?'yes':'no';}
for(key in extraParams){if(extraParams.hasOwnProperty(key)){keys.push(key);}}
keys.sort();for(i=0,len=keys.length;i<len;i+=1){key=keys[i];out.push(key+'='+extraParams[key]);}
return out.join(';');}
function track(eventName,data,value,forcedLabel){var category='ad/'+eventName,action=typeof data==='string'?data:encodeAsQueryString(data||{}),gaLabel=forcedLabel,gaValue,trackValue;if(!gaLabel){if(value===undefined){gaLabel='';value=0;}else{gaLabel=timeBuckets.getTimeBucket(buckets,value/1000);if(/\+$|invalid/.test(gaLabel)){category=category.replace('ad','ad/error');}}}
gaValue=Math.round(value);action=action||'nodata';trackValue={ga_category:category,ga_action:action,ga_label:gaLabel,ga_value:isNaN(gaValue)?0:gaValue,trackingMethod:'ad'};tracker.track(trackValue);log(trackValue,'debug',logGroup);}
function trackDW(data,eventName){var trackValue={eventName:eventName,trackingMethod:'internal'};if(typeof data==='string'){trackValue.ping=data;}else{Object.keys(data).forEach(function(key){trackValue[key]=data[key];});}
tracker.track(trackValue);log(['trackDW',trackValue],'debug',logGroup);}
function measureTime(eventName,eventData,eventType){var timingValue=win.wgNow&&new Date().getTime()-win.wgNow.getTime();eventType=eventType?'/'+eventType:'';return{measureDiff:function(diffData,diffType){eventType='/'+diffType;eventData=diffData;timingValue=win.wgNow&&new Date().getTime()-win.wgNow.getTime()-timingValue;return{track:this.track};},track:function(){if(timingValue){track('timing/'+eventName+eventType,eventData,timingValue);}}};}
return{track:track,trackDW:trackDW,measureTime:measureTime};});;define('ext.wikia.adEngine.utils.sampler',['wikia.querystring'],function(QueryString){'use strict';var qs=new QueryString(),queryStringParam='ignored_samplers';function samplerIsIgnored(name){var ignored=qs.getVal(queryStringParam,'').split(',');return ignored.indexOf(name)>-1;}
function sample(name,partToSample,all){return samplerIsIgnored(name)?true:getRandomInt(0,all)<partToSample;}
function getRandomInt(min,max){return Math.floor(Math.random()*(max-min))+min;}
return{sample:sample};});;define('ext.wikia.adEngine.utils.timeBuckets',function(){function getTimeBucket(timeBuckets,time){var i,len=timeBuckets.length,bucket;for(i=0;i<len;i+=1){if(time>=timeBuckets[i]){bucket=i;}}
if(bucket===len-1){return timeBuckets[bucket]+'+';}
if(bucket>=0){return timeBuckets[bucket]+'-'+timeBuckets[bucket+1];}
return'invalid';}
return{getTimeBucket:getTimeBucket}});;define('ext.wikia.adEngine.adContext',['wikia.abTest','wikia.cookies','wikia.document','wikia.geo','wikia.instantGlobals','ext.wikia.adEngine.utils.sampler','wikia.window','wikia.querystring'],function(abTest,cookies,doc,geo,instantGlobals,sampler,w,Querystring){'use strict';instantGlobals=instantGlobals||{};var context,callbacks=[],qs=new Querystring();function getContext(){return context;}
function getMercuryCategories(){if(!context.targeting.mercuryPageCategories){return;}
return context.targeting.mercuryPageCategories.map(function(item){return item.title;});}
function isUrlParamSet(param){return!!parseInt(qs.getVal(param,'0'),10);}
function isPageType(pageType){return context.targeting.pageType===pageType;}
function isRecoveryModuleEnabled(wgCountries,contextVariable){var isGeoSupported=geo.isProperGeo(wgCountries),isNotDisabledOnWiki=contextVariable!==false;return!!(isNotDisabledOnWiki&&isGeoSupported);}
function setContext(newContext){var i,len,noExternals=w.wgNoExternals||isUrlParamSet('noexternals'),taboolaConfig=instantGlobals.wgAdDriverTaboolaConfig||{};context=newContext;context.opts=context.opts||{};context.slots=context.slots||{};context.targeting=context.targeting||{};context.providers=context.providers||{};context.forcedProvider=qs.getVal('forcead',null)||context.forcedProvider||null;context.opts.noExternals=noExternals;if(doc&&doc.referrer&&doc.referrer.match(/info\.tvsideview\.sony\.net/)){context.opts.showAds=false;}
if(geo.isProperGeo(instantGlobals.wgAdDriverDelayCountries)){context.opts.delayEngine=true;}
if(!noExternals){var geoIsSupported=geo.isProperGeo(instantGlobals.wgAdDriverPageFairDetectionCountries),forcePageFairByURL=isUrlParamSet('pagefairdetection'),canBeSampled=sampler.sample('pageFairDetection',1,10);if(forcePageFairByURL||(geoIsSupported&&canBeSampled)){context.opts.pageFairDetection=true;}}
context.opts.pageFairRecovery=noExternals?false:isRecoveryModuleEnabled(instantGlobals.wgAdDriverPageFairRecoveryCountries,context.opts.pageFairRecovery);context.opts.sourcePointRecovery=noExternals?false:isRecoveryModuleEnabled(instantGlobals.wgAdDriverSourcePointRecoveryCountries,context.opts.sourcePointRecovery);if(noExternals&&context.opts.sourcePointMMS===true){context.opts.sourcePointMMS=false;}
if(context.opts.sourcePointMMS||context.opts.sourcePointRecovery){context.opts.sourcePointBootstrap=true;}
if(!noExternals&&context.opts.sourcePointDetectionUrl){context.opts.sourcePointDetection=(context.targeting.skin==='oasis'&&geo.isProperGeo(instantGlobals.wgAdDriverSourcePointDetectionCountries));context.opts.sourcePointDetectionMobile=(context.targeting.skin==='mercury'&&geo.isProperGeo(instantGlobals.wgAdDriverSourcePointDetectionMobileCountries));}
if(!noExternals){if(shouldLoadTaboolaOnBlockingTraffic(taboolaConfig)){context.opts.loadTaboolaLibrary=true;}}
if(context.opts.sourcePointDetection&&!context.opts.sourcePointRecovery&&context.opts.showAds){context.opts.googleConsumerSurveys=abTest.getGroup('PROJECT_43')==='GROUP_5'&&geo.isProperGeo(instantGlobals.wgAdDriverGoogleConsumerSurveysCountries);}
if(cookies.get('mock-ads')==='NlfdjR5xC0'){context.opts.showcase=true;}
if(context.targeting.enablePageCategories){context.targeting.pageCategories=w.wgCategories||getMercuryCategories();}
if(context.providers.evolve2){context.providers.evolve2=geo.isProperGeo(instantGlobals.wgAdDriverEvolve2Countries);}
if(geo.isProperGeo(instantGlobals.wgAdDriverTurtleCountries)){context.providers.turtle=true;}
if(context.providers.rubiconFastlane){context.providers.rubiconFastlane=geo.isProperGeo(instantGlobals.wgAdDriverRubiconFastlaneCountries)&&geo.isProperGeo(instantGlobals.wgAdDriverRubiconFastlaneProviderCountries);}
context.opts.enableRemnantNewAdUnit=geo.isProperGeo(instantGlobals.wgAdDriverMEGACountries);context.slots.invisibleHighImpact=(context.slots.invisibleHighImpact&&geo.isProperGeo(instantGlobals.wgAdDriverHighImpactSlotCountries))||isUrlParamSet('highimpactslot');context.opts.incontentLeaderboardAsOutOfPage=geo.isProperGeo(instantGlobals.wgAdDriverIncontentLeaderboardOutOfPageSlotCountries);context.opts.enableAdInfoLog=geo.isProperGeo(instantGlobals.wgAdDriverKikimoraTrackingCountries);context.opts.playerTracking=geo.isProperGeo(instantGlobals.wgAdDriverKikimoraPlayerTrackingCountries);context.targeting.enableKruxTargeting=!!(context.targeting.enableKruxTargeting&&geo.isProperGeo(instantGlobals.wgAdDriverKruxCountries)&&!instantGlobals.wgSitewideDisableKrux);context.opts.floatingMedrec=!!(context.opts.showAds&&context.opts.adsInContent&&(isPageType('article')||isPageType('search'))&&!context.targeting.wikiIsCorporate);context.opts.overridePrefootersSizes=!!(context.targeting.skin==='oasis'&&geo.isProperGeo(instantGlobals.wgAdDriverOverridePrefootersCountries)&&!isPageType('home'));context.opts.openXRemnantEnabled=geo.isProperGeo(instantGlobals.wgAdDriverOpenXBidderCountriesRemnant);if(w.ads&&w.ads.context){w.ads.context=context;}
for(i=0,len=callbacks.length;i<len;i+=1){callbacks[i](context);}}
function shouldLoadTaboolaOnBlockingTraffic(taboolaConfig){var i,taboolaSlot;for(taboolaSlot in taboolaConfig){if(taboolaConfig.hasOwnProperty(taboolaSlot)&&taboolaConfig[taboolaSlot].recovery){for(i=0;i<taboolaConfig[taboolaSlot].recovery.length;i++){if(geo.isProperGeo(taboolaConfig[taboolaSlot].recovery[i])){return true;}}}}
return false;}
function addCallback(callback){callbacks.push(callback);}
setContext(w.ads?w.ads.context:{});return{addCallback:addCallback,getContext:getContext,setContext:setContext};});;define('ext.wikia.adEngine.context.slotsContext',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.utils.adLogicZoneParams','wikia.geo','wikia.instantGlobals','wikia.log'],function(adContext,params,geo,instantGlobals,log){'use strict';var logGroup='ext.wikia.adEngine.context.slotsContext',slots={};function setStatus(slotName,status){slots[slotName]=!!status;}
function setupSlots(){var context=adContext.getContext(),isHome=params.getPageType()==='home';setStatus('PREFOOTER_MIDDLE_BOXAD',isHome);setStatus('TOP_LEADERBOARD',true);setStatus('TOP_RIGHT_BOXAD',true);setStatus('LEFT_SKYSCRAPER_2',!isHome);setStatus('LEFT_SKYSCRAPER_3',!isHome);setStatus('INCONTENT_BOXAD_1',!isHome);setStatus('INVISIBLE_HIGH_IMPACT_2',geo.isProperGeo(instantGlobals.wgAdDriverHighImpact2SlotCountries));setStatus('INCONTENT_LEADERBOARD',geo.isProperGeo(instantGlobals.wgAdDriverIncontentLeaderboardSlotCountries));setStatus('INCONTENT_PLAYER',geo.isProperGeo(instantGlobals.wgAdDriverIncontentPlayerSlotCountries));setStatus('PREFOOTER_RIGHT_BOXAD',!context.opts.overridePrefootersSizes);log(['Disabled slots:',slots],'info',logGroup);}
function isApplicable(slotName){return slots[slotName]!==false;}
function filterSlotMap(slotMap){var map={};if(!slotMap){return map;}
Object.keys(slotMap).forEach(function(slotName){if(isApplicable(slotName)){map[slotName]=slotMap[slotName];}});return map;}
setupSlots();adContext.addCallback(function(){setupSlots();});return{filterSlotMap:filterSlotMap,isApplicable:isApplicable};});;define('ext.wikia.adEngine.lookup.lookupFactory',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.adTracker','ext.wikia.aRecoveryEngine.adBlockDetection','wikia.lazyqueue','wikia.log'],function(adContext,adTracker,adBlockDetection,lazyQueue,log){'use strict';function create(module){var called=false,onResponseCallbacks=[],response=false,timing,context=adContext.getContext();function onResponse(){log('onResponse','debug',module.logGroup);timing.measureDiff({},'end').track();module.calculatePrices();response=true;onResponseCallbacks.start();if(module.name==='prebid'){module.trackAdaptersOnLookupEnd();}else{adTracker.track(module.name+'/lookup_end',module.getPrices(),0,'nodata');}}
function addResponseListener(callback){onResponseCallbacks.push(callback);}
function call(){log('call','debug',module.logGroup);response=false;if(!Object.keys){log(['call','Module is not supported in IE8',module.name],'debug',module.logGroup);return;}
timing=adTracker.measureTime(module.name,{},'start');timing.track();module.call(context.targeting.skin||'mercury',onResponse);called=true;adBlockDetection.addOnBlockingCallback(onResponseCallbacks.start);}
function wasCalled(){log(['wasCalled',called],'debug',module.logGroup);return called;}
function trackState(providerName,slotName,params){log(['trackState',response,providerName,slotName],'debug',module.logGroup);var category,encodedParams,eventName;if(!module.isSlotSupported(slotName)){log(['trackState','Not supported slot',slotName],'debug',module.logGroup);return;}
if(module.name==='prebid'){module.trackAdaptersSlotState(providerName,slotName,params);}else{encodedParams=module.encodeParamsForTracking(params,slotName);eventName=encodedParams?'lookup_success':'lookup_error';category=module.name+'/'+eventName+'/'+providerName;adTracker.track(category,slotName,0,encodedParams||'nodata');}}
function getSlotParams(slotName){log(['getSlotParams',slotName,called,response],'debug',module.logGroup);if(!called||!module.isSlotSupported(slotName)){log(['getSlotParams','Not called or slot is not supported',slotName],'debug',module.logGroup);return{};}
return module.getSlotParams(slotName);}
function getBestSlotPrice(slotName){if(module.getBestSlotPrice){return module.getBestSlotPrice(slotName);}
return{};}
function getName(){return module.name;}
function hasResponse(){log(['hasResponse',response],'debug',module.logGroup);return response;}
function isSlotSupported(slotName){return module.isSlotSupported(slotName);}
lazyQueue.makeQueue(onResponseCallbacks,function(callback){callback();});return{addResponseListener:addResponseListener,call:call,getBestSlotPrice:getBestSlotPrice,getName:getName,getSlotParams:getSlotParams,hasResponse:hasResponse,isSlotSupported:isSlotSupported,trackState:trackState,wasCalled:wasCalled};}
return{create:create};});;define('ext.wikia.adEngine.slot.adSlot',['ext.wikia.adEngine.slot.adUnitBuilder','ext.wikia.adEngine.slot.service.megaAdUnitBuilder','wikia.document','wikia.log','wikia.window',require.optional('ext.wikia.aRecoveryEngine.adBlockDetection')],function(adUnitBuilder,megaAdUnitBuilder,doc,log,win,adBlockDetection){'use strict';var logGroup='ext.wikia.adEngine.slot.adSlot';function create(name,container,callbacks){function registerHook(name){return function(adInfo){if(typeof callbacks[name]==='function'){callbacks[name](adInfo);}};}
return{name:name,container:container,isViewed:false,collapse:registerHook('collapse'),hop:registerHook('hop'),renderEnded:registerHook('renderEnded'),success:registerHook('success'),viewed:registerHook('viewed')};}
function getShortSlotName(slotName){if(megaAdUnitBuilder.isValid(slotName)){return megaAdUnitBuilder.getShortSlotName(slotName);}
return adUnitBuilder.getShortSlotName(slotName);}
function getRecoveredIframe(slotName){var node=doc.querySelector('#'+slotName+' > .provider-container:not(.hidden) > div'),fallbackId=node&&win._sp_.getElementId(node.id),elementById=fallbackId&&doc.getElementById(fallbackId);if(elementById){return elementById.querySelector('div[id*="_container_"] iframe');}}
function getIframe(slotName){var cssSelector='#'+slotName+' > .provider-container:not(.hidden) div[id*="_container_"] > iframe',iframe=doc.querySelector(cssSelector);if(!iframe&&adBlockDetection&&adBlockDetection.isBlocking()){iframe=getRecoveredIframe(slotName);}
log(['getIframe',slotName,iframe&&iframe.id],log.levels.debug,logGroup);return iframe;}
function getRecoveredProviderContainer(providerContainer){var elementId=providerContainer.childNodes.length>0&&providerContainer.childNodes[0].id,recoveredElementId=win._sp_.getElementId(elementId),element=doc.getElementById(recoveredElementId);log(['getRecoveredProviderContainer for container',providerContainer],log.levels.debug,logGroup);log(['getRecoveredProviderContainer recovered element ID',recoveredElementId],log.levels.debug,logGroup);log(['getRecoveredProviderContainer recovered element',element],log.levels.debug,logGroup);if(element&&element.parentNode){log(['getRecoveredProviderContainer recovered provider container',element.parentNode],log.levels.debug,logGroup);return element.parentNode;}
return null;}
function getProviderContainer(slotName){var isRecovering=adBlockDetection.isBlocking(),providerContainer,slotContainer=doc.getElementById(slotName);providerContainer=slotContainer.lastElementChild;if(isRecovering&&providerContainer.hasAttribute('data-sp-clone')){providerContainer=getRecoveredProviderContainer(providerContainer);}
return providerContainer;}
return{create:create,getIframe:getIframe,getProviderContainer:getProviderContainer,getShortSlotName:getShortSlotName};});;define('ext.wikia.adEngine.slot.adUnitBuilder',['ext.wikia.adEngine.adLogicPageParams'],function(page){'use strict';var dfpId='5441';function build(slotName,src){var params=page.getPageLevelParams();if(slotName instanceof Array){slotName=slotName[0];}
return['',dfpId,'wka.'+params.s0,params.s1,'',params.s2,src,slotName].join('/');}
function getShortSlotName(adUnit){return adUnit.replace(/^.*\/([^\/]*)$/,'$1');}
return{build:build,getShortSlotName:getShortSlotName};});;define('ext.wikia.adEngine.slot.slotTargeting',['ext.wikia.adEngine.adContext'],function(adContext){'use strict';var skins={mercury:'m',oasis:'o'},pageTypes={article:'a',home:'h'},slotSources={gpt:'1',mobile:'1',remnant:'2',mobile_remnant:'2'},wsiSlots={TOP_LEADERBOARD:'l',TOP_RIGHT_BOXAD:'m',INCONTENT_PLAYER:'i',INCONTENT_LEADERBOARD:'i',INCONTENT_BOXAD_1:'f',BOTTOM_LEADERBOARD:'b',MOBILE_TOP_LEADERBOARD:'l',MOBILE_IN_CONTENT:'i',MOBILE_PREFOOTER:'p',MOBILE_BOTTOM_LEADERBOARD:'b'};function valueOrX(map,key){if(!key||!map[key]){return'x';}
return map[key];}
function getWikiaSlotId(slotName,slotSource){var context=adContext.getContext(),skin=valueOrX(skins,context.targeting.skin),slot=valueOrX(wsiSlots,slotName),pageType=valueOrX(pageTypes,context.targeting.pageType),src=valueOrX(slotSources,slotSource);return skin+slot+pageType+src;}
return{getWikiaSlotId:getWikiaSlotId};});;define('ext.wikia.adEngine.slot.service.megaAdUnitBuilder',['ext.wikia.adEngine.adLogicPageParams','wikia.browserDetect'],function(page,browserDetect){'use strict';var dfpId='5441';function findSlotGroup(map,slotName){var result=Object.keys(map).filter(function(name){return map[name].indexOf(slotName)!==-1;});return result.length===1?result[0]:null;}
function getGroup(slotName){var map={'LB':['TOP_LEADERBOARD','MOBILE_TOP_LEADERBOARD'],'MR':['TOP_RIGHT_BOXAD'],'SKY':['LEFT_SKYSCRAPER_2','LEFT_SKYSCRAPER_3'],'PF':['PREFOOTER_LEFT_BOXAD','PREFOOTER_MIDDLE_BOXAD','PREFOOTER_RIGHT_BOXAD','MOBILE_PREFOOTER'],'PX':['INVISIBLE_SKIN','INVISIBLE_HIGH_IMPACT_2'],'HiVi':['INCONTENT_BOXAD_1','MOBILE_IN_CONTENT']};return findSlotGroup(map,slotName)||'OTHER';}
function getDevice(params){var result='unknown';if(params.s2==='special'){return'unknown-specialpage';}
if(params.skin==='oasis'){result=browserDetect.isMobile()?'tablet':'desktop';}else if(params.skin==='mercury'||params.skin==='mobile-wiki'){result='smartphone';}
return result;}
function build(slotName,src,passback){var adUnitElements,params=page.getPageLevelParams(),device=getDevice(params),skin=params.skin,pageType=params.s2,provider=src.indexOf('remnant')===-1?'wka1':'wka2',wikiName=params.s1,vertical=params.s0;adUnitElements=['',dfpId,provider+'.'+getGroup(slotName),slotName.toLowerCase(),device,skin+'-'+pageType,wikiName+'-'+vertical];if(passback){adUnitElements.push(passback);}
return adUnitElements.join('/');}
function isValid(adUnit){return adUnit.indexOf('wka1.')!==-1||adUnit.indexOf('wka2.')!==-1;}
function getShortSlotName(adUnit){return adUnit.replace(/^.*\/(wka1|wka2)\.[\w]+\/([^\/]*)\/.*$/,function(){if(arguments[2]){return arguments[2].toUpperCase();}});}
return{build:build,getShortSlotName:getShortSlotName,isValid:isValid};});;define('ext.wikia.adEngine.utils.adLogicZoneParams',['ext.wikia.adEngine.adContext','wikia.log','wikia.location'],function(adContext,log,loc){'use strict';var calculated=false,context={},hostname=loc.hostname,logGroup='ext.wikia.adEngine.utils.adLogicZoneParams',maxNumberOfCategories=3,site,zone1,zone2;function updateContext(){context=adContext.getContext();calculated=false;}
function getDomain(){var lhost,pieces,sld='',np;lhost=hostname.toLowerCase();pieces=lhost.split('.');np=pieces.length;if(pieces[np-2]==='co'){sld=pieces[np-3]+'.'+pieces[np-2]+'.'+pieces[np-1];}else{sld=pieces[np-2]+'.'+pieces[np-1];}
return sld.replace(/\./g,'');}
function getHostnamePrefix(){var lhost=hostname.toLowerCase(),pieces=lhost.split('.');if(pieces.length){return pieces[0];}}
function getVerticalName(targeting){if(getHostnamePrefix()==='showcase'||context.opts.showcase===true){return'showcase';}
return targeting.mappedVerticalName;}
function getRawDbName(){return'_'+(context.targeting.wikiDbName||'wikia').replace('/[^0-9A-Z_a-z]/','_');}
function calculateParams(){log('calculateParams','info',logGroup);var mappedVertical=getVerticalName(context.targeting);if(context.targeting.pageIsHub){site='hub';zone1='_'+mappedVertical+'_hub';zone2='hub';}else{site=mappedVertical;zone1=getRawDbName();zone2=context.targeting.pageType||'article';}
calculated=true;log(['calculateParams',site,zone1,zone2],'info',logGroup);}
function getSite(){if(!calculated){calculateParams();}
return site;}
function getName(){if(!calculated){calculateParams();}
return zone1;}
function getPageType(){if(!calculated){calculateParams();}
return zone2;}
function getVertical(){return context.targeting.wikiVertical;}
function getPageCategories(){var categories=context.targeting.pageCategories,outCategories;if(categories instanceof Array&&categories.length>0){outCategories=categories.slice(0,maxNumberOfCategories);return outCategories.join('|').toLowerCase().replace(/ /g,'_').split('|');}}
function getLanguage(){return context.targeting.wikiLanguage||'unknown';}
function getWikiCategories(){return context.targeting.newWikiCategories;}
updateContext();adContext.addCallback(updateContext);return{getDomain:getDomain,getHostnamePrefix:getHostnamePrefix,getSite:getSite,getName:getName,getPageType:getPageType,getVertical:getVertical,getPageCategories:getPageCategories,getWikiCategories:getWikiCategories,getLanguage:getLanguage,getRawDbName:getRawDbName};});;define('ext.wikia.adEngine.video.vastUrlBuilder',['ext.wikia.adEngine.adLogicPageParams','ext.wikia.adEngine.slot.adUnitBuilder','ext.wikia.adEngine.slot.slotTargeting','wikia.location','wikia.log'],function(page,adUnitBuilder,slotTargeting,loc,log){'use strict';var adSizes={vertical:'320x480',horizontal:'640x480'},baseUrl='https://pubads.g.doubleclick.net/gampad/ads?',logGroup='ext.wikia.adEngine.video.vastUrlBuilder';function getCustomParameters(slotParams){var customParameters,params=page.getPageLevelParams(),wsi=slotTargeting.getWikiaSlotId(slotParams.pos,slotParams.src);customParameters=['wsi='+wsi];Object.keys(params).forEach(function(key){if(params[key]){customParameters.push(key+'='+params[key]);}});Object.keys(slotParams).forEach(function(key){if(slotParams[key]){customParameters.push(key+'='+slotParams[key]);}});return encodeURIComponent(customParameters.join('&'));}
function isNumeric(n){return!isNaN(parseFloat(n))&&isFinite(n);}
function getSizeByAspectRatio(aspectRatio){return aspectRatio>=1||!isNumeric(aspectRatio)?adSizes.horizontal:adSizes.vertical;}
function build(aspectRatio,slotParams){slotParams=slotParams||{};var correlator=Math.round(Math.random()*10000000000),params=['output=vast','env=vp','gdfp_req=1','impl=s','unviewed_position_start=1','iu='+adUnitBuilder.build(slotParams.pos,slotParams.src),'sz='+getSizeByAspectRatio(aspectRatio),'url='+loc.href,'correlator='+correlator,'cust_params='+getCustomParameters(slotParams)],url=baseUrl+params.join('&');log(['build',url],'debug',logGroup);return url;}
return{build:build};});;define('ext.wikia.aRecoveryEngine.adBlockDetection',['ext.wikia.adEngine.adContext','ext.wikia.aRecoveryEngine.sourcePoint.recovery','wikia.document','wikia.instantGlobals','wikia.lazyqueue','wikia.log'],function(adContext,sourcePoint,doc,instantGlobals,lazyQueue,log){'use strict';var cb=function(callback){callback();},logGroup='ext.wikia.aRecoveryEngine.adBlockDetection',onBlockingEventsQueue=lazyQueue.makeQueue([],cb),onNotBlockingEventsQueue=lazyQueue.makeQueue([],cb);function initEventQueues(){doc.addEventListener('sp.not_blocking',onNotBlockingEventsQueue.start);doc.addEventListener('sp.blocking',onBlockingEventsQueue.start);}
function addOnBlockingCallback(callback){onBlockingEventsQueue.push(callback);}
function addOnNotBlockingCallback(callback){onNotBlockingEventsQueue.push(callback);}
function isBlocking(){return isEnabled()&&sourcePoint.isBlocking();}
function isEnabled(){var context=adContext.getContext();log(['isEnabled',context.opts.sourcePointDetection],log.levels.debug,logGroup);return context.opts.sourcePointDetection;}
return{addOnBlockingCallback:addOnBlockingCallback,addOnNotBlockingCallback:addOnNotBlockingCallback,initEventQueues:initEventQueues,isBlocking:isBlocking,isEnabled:isEnabled};});;define('ext.wikia.aRecoveryEngine.adBlockRecovery',['ext.wikia.adEngine.adContext','ext.wikia.aRecoveryEngine.adBlockDetection','wikia.document','wikia.instantGlobals','wikia.log','wikia.window'],function(adContext,adBlockDetection,doc,instantGlobals,log,win){'use strict';var customLogEndpoint='/wikia.php?controller=ARecoveryEngineApi&method=getLogInfo&kind=',logGroup='ext.wikia.aRecoveryEngine.adBlockRecovery';function getName(){return'adBlockRecovery';}
function addResponseListener(callback){adBlockDetection.addOnBlockingCallback(callback);adBlockDetection.addOnNotBlockingCallback(callback);}
function getSafeUri(url){if(adBlockDetection.isBlocking()){url=win._sp_.getSafeUri(url);}
return url;}
function isEnabled(){var context=adContext.getContext(),enabled=adBlockDetection.isEnabled()&&(context.opts.sourcePointRecovery||context.opts.pageFairRecovery);log(['isEnabled',enabled],log.levels.debug,logGroup);return enabled;}
function track(type){if(win._sp_&&!win._sp_.trackingSent){if(Wikia&&Wikia.Tracker){Wikia.Tracker.track({eventName:'ads.recovery',category:'ads-recovery-blocked',action:Wikia.Tracker.ACTIONS.IMPRESSION,label:type,trackingMethod:'analytics'});}
if(instantGlobals.wgARecoveryEngineCustomLog){sendCustomLog(type);}
win._sp_.trackingSent=true;}}
function sendCustomLog(type){var xmlHttp=new XMLHttpRequest();try{xmlHttp.open('GET',customLogEndpoint+type,true);xmlHttp.send();}catch(e){log(['track',e],log.levels.error,logGroup);}}
function verifyContent(){var wikiaArticle=doc.getElementById('WikiaArticle'),display=wikiaArticle.currentStyle?wikiaArticle.currentStyle.display:getComputedStyle(wikiaArticle,null).display;if(display==='none'){track('css-display-none');}}
return{addResponseListener:addResponseListener,isEnabled:isEnabled,getName:getName,getSafeUri:getSafeUri,track:track,verifyContent:verifyContent,wasCalled:isEnabled};});;define('ext.wikia.aRecoveryEngine.recovery.sourcePoint',['ext.wikia.adEngine.adContext','ext.wikia.aRecoveryEngine.adBlockDetection','wikia.document','wikia.instantGlobals','wikia.log','wikia.window'],function(adContext,adBlockDetection,doc,instantGlobals,log,win){'use strict';var customLogEndpoint='/wikia.php?controller=ARecoveryEngineApi&method=getLogInfo&kind=',logGroup='ext.wikia.aRecoveryEngine.adBlockRecovery';function getName(){return'adBlockRecovery';}
function addResponseListener(callback){adBlockDetection.addOnBlockingCallback(callback);adBlockDetection.addOnNotBlockingCallback(callback);}
function getSafeUri(url){if(isBlocking()){url=win._sp_.getSafeUri(url);}
return url;}
function isEnabled(){var context=adContext.getContext(),enabled=adBlockDetection.isEnabled()&&(context.opts.sourcePointRecovery||context.opts.pageFairRecovery);log(['isEnabled',enabled],log.levels.debug,logGroup);return enabled;}
function track(type){if(win._sp_&&!win._sp_.trackingSent){if(Wikia&&Wikia.Tracker){Wikia.Tracker.track({eventName:'ads.recovery',category:'ads-recovery-blocked',action:Wikia.Tracker.ACTIONS.IMPRESSION,label:type,trackingMethod:'analytics'});}
if(instantGlobals.wgARecoveryEngineCustomLog){try{var xmlHttp=new XMLHttpRequest();xmlHttp.open('GET',customLogEndpoint+type,true);xmlHttp.send();}catch(e){log(['track',e],log.levels.error,logGroup);}}
win._sp_.trackingSent=true;}}
function verifyContent(){var wikiaArticle=doc.getElementById('WikiaArticle'),display=wikiaArticle.currentStyle?wikiaArticle.currentStyle.display:getComputedStyle(wikiaArticle,null).display;if(display==='none'){track('css-display-none');}}
return{addResponseListener:addResponseListener,isEnabled:isEnabled,getName:getName,getSafeUri:getSafeUri,track:track,verifyContent:verifyContent,wasCalled:isEnabled};});;define('ext.wikia.aRecoveryEngine.sourcePoint.recovery',['ext.wikia.adEngine.adContext','wikia.log','wikia.window'],function(adContext,log,win){'use strict';var logGroup='ext.wikia.aRecoveryEngine.sourcePoint.recovery',context=adContext.getContext(),recoverableSlots=['TOP_LEADERBOARD','TOP_RIGHT_BOXAD','LEFT_SKYSCRAPER_2','LEFT_SKYSCRAPER_3','INCONTENT_BOXAD_1','BOTTOM_LEADERBOARD','GPT_FLUSH'];function isEnabled(){var enabled=!!context.opts.sourcePointRecovery&&!context.opts.pageFairRecovery;log(['isEnabled',enabled],log.levels.debug,logGroup);return enabled;}
function isBlocking(){var isBlocking=!!(win.ads&&win.ads.runtime.sp&&win.ads.runtime.sp.blocking);log(['isBlocking',isBlocking],log.levels.debug,logGroup);return isBlocking;}
function isSlotRecoverable(slotName){var result=isEnabled()&&recoverableSlots.indexOf(slotName)!==-1;log(['isSlotRecoverable',result],log.levels.info,logGroup);return result;}
return{isBlocking:isBlocking,isSlotRecoverable:isSlotRecoverable,isEnabled:isEnabled};});;define('wikia.browserDetect',['wikia.window'],function(win){'use strict';var appName=win.navigator.appName,userAgent=win.navigator.userAgent,browser=null,operatingSystem=null;function isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);}
function isIE(){var bool=false;if(appName==='Microsoft Internet Explorer'||(appName==='Netscape'&&userAgent.indexOf('Trident/')!==-1)){bool=true;}
return bool;}
function isEdge(){return userAgent.indexOf('Edge')!==-1;}
function isFirefox(){return userAgent.toLowerCase().indexOf('firefox')>-1;}
function isIPad(){var bool=false;if(userAgent.match(/iPad/i)!==null){bool=true;}
return bool;}
function isIOS7orLower(){return!!userAgent.match(/iPad.+OS.[6,7].\d.+like.Mac.OS.+Safari/i);}
function isAndroid(){return userAgent.toLowerCase().indexOf('android')>-1;}
function getOS(){if(null!==operatingSystem){return operatingSystem;}
operatingSystem='unknown';if(userAgent.indexOf('Win')!==-1){operatingSystem='Windows';}
if(userAgent.indexOf('Mac')!==-1){operatingSystem='OSX';}
if(userAgent.indexOf('Linux')!==-1){operatingSystem='Linux';}
if(userAgent.indexOf('Android')!==-1){operatingSystem='Android';}
if(userAgent.indexOf('like Mac')!==-1){operatingSystem='iOS';}
return operatingSystem;}
function getBrowser(){if(null!==browser){return browser;}
var appVersion=win.navigator.appVersion,temp,matches=userAgent.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(matches[1])){temp=/\brv[ :]+(\d+)/g.exec(userAgent)||[];browser='IE '+(temp[1]||'');return browser;}
if(matches[1]==='Chrome'){temp=userAgent.match(/\b(OPR|Edge)\/(\d+)/);if(temp!==null){browser=temp.slice(1).join(' ').replace('OPR','Opera');return browser;}}
matches=matches[2]?[matches[1],matches[2]]:[appName,appVersion,'-?'];temp=userAgent.match(/version\/(\d+)/i);if(temp!==null){matches.splice(1,1,temp[1]);}
browser=matches.join(' ');return browser;}
return{getBrowser:getBrowser,getOS:getOS,isIE:isIE,isFirefox:isFirefox,isIPad:isIPad,isIOS7orLower:isIOS7orLower,isAndroid:isAndroid,isMobile:isMobile,isEdge:isEdge};});;window.Krux||((Krux=function(){Krux.q.push(arguments);}).q=[]);define('wikia.krux',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.adTracker','wikia.document','wikia.tracker','wikia.window'],function(adContext,adTracker,doc,wikiaTracker,win){'use strict';var maxNumberOfKruxSegments=50,kruxScriptId='krux-control-tag',kruxLoaded=false,segmentsCountTracked=false;function exportPageParams(adLogicPageParams){var params,value;if(Object.keys){params=adLogicPageParams.getPageLevelParams();Object.keys(params).forEach(function(key){value=params[key];if(value){win['kruxDartParam_'+key]=value.toString();}});}}
function addConfigScript(confid){var k,s;k=document.createElement('script');k.type='text/javascript';k.id=kruxScriptId;k.async=true;k.src=(location.protocol==='https:'?'https:':'http:')+'//cdn.krxd.net/controltag?confid='+confid;s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(k,s);}
function load(confid){require(['ext.wikia.adEngine.adContext','ext.wikia.adEngine.adLogicPageParams'],function(adContext,adLogicPageParams){var script;if(adContext.getContext().targeting.enableKruxTargeting){exportPageParams(adLogicPageParams);script=doc.getElementById(kruxScriptId);if(script){script.parentNode.removeChild(script);}
addConfigScript(confid);kruxLoaded=true;adTracker.track('krux/load');wikiaTracker.track({category:'ads-trackers',action:'krux',label:'load',value:0,trackingMethod:'analytics'});}});}
function getParams(n){var k='kx'+n;if(win.localStorage){return win.localStorage[k]||'';}else{return'';}}
function trackNumberOfSegments(numberOfSegments){if(segmentsCountTracked){return;}
var label=numberOfSegments+'';while(label.length<4){label='0'+label;}
adTracker.track('krux/segments_count',{},numberOfSegments,label);segmentsCountTracked=true;}
function getSegments(){var segments=getParams('segs'),segsArray;if(segments===''){trackNumberOfSegments(0);return[];}
segsArray=segments.split(',');trackNumberOfSegments(segsArray.length);return segsArray.slice(0,maxNumberOfKruxSegments);}
function getUser(){return getParams('user');}
function sendEvent(eventId,data){if(!kruxLoaded){return false;}
Krux('admEvent',eventId,data||{});return true;}
adContext.addCallback(function(){segmentsCountTracked=false;});return{load:load,getSegments:getSegments,getUser:getUser,sendEvent:sendEvent};});;


window.visitorType=(document.cookie.indexOf('__utma')>-1)?'Returning':'New';;